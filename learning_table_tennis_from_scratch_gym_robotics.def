Bootstrap: localimage
From: pam_mujoco.sif

%files
    build/cluster_utils /cluster_utils

%post
    #install learning_tts
    git clone https://github.com/intelligent-soft-robots/learning_table_tennis_from_scratch.git
    cd learning_table_tennis_from_scratch
    git checkout sguist/test_stable_baselines_hsm
    pip3 install --no-cache-dir .
    cd ..

    #install sb3 with changes
    git clone https://github.com/rodrigodelazcano/stable-baselines3.git
    cd stable-baselines3
    git checkout fix_tests
    cd ..
    cd learning_table_tennis_from_scratch/learning_table_tennis_from_scratch/sb3
    cp __init__.py her_replay_buffer.py hindsight_state_selection_strategy.py ../../../stable-baselines3/stable_baselines3/her/
    cp sac.py ../../../stable-baselines3/stable_baselines3/sac/
    cd ../../..
    cd stable-baselines3
    pip3 install --no-cache-dir .[extra]
    cd ..

    #install Gymnasium-Robotics-HYSR
    git clone https://github.com/simonguist/Gymnasium-Robotics-HYSR.git
    cd Gymnasium-Robotics-HYSR
    git checkout sb3-compatible
    pip3 install --no-cache-dir .
    cd ..

    pip3 install mujoco=="2.2.1" imageio=="2.16.1"
    
    #remove folders
    rm -rf learning_table_tennis_from_scratch
    rm -rf stable-baselines3


    # also install cluster_utils for hyperparameter optimisation
    cd /cluster_utils
    pip3 install --no-cache-dir .
    cd -
    rm -rf /cluster_utils
